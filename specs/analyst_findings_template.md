# Analyst Findings Template

This template defines the structure for Power BI analyst findings reports. All sections are optional and should only be included when relevant to the analysis.

## Document Structure

### Problem Statement
[Clear description of the user's request, issue, or requirement that prompted this analysis]

---

## Prerequisites: Project Setup Validation
[Generated by powerbi-verify-pbiproject-folder-setup agent]

This section documents the project format detection, validation, and setup required before analysis can proceed. The command reads these fields to determine workflow progression.

**Validation Date**: [YYYY-MM-DD HH:MM:SS]
**Agent**: powerbi-verify-pbiproject-folder-setup
**Status**: [validated | action_required | error]
**Action Type**: [none | pbix_extraction | pbitools_install | invalid_format | invalid_tmdl_structure | extraction_failed | pbitools_not_found | manual_extraction_pending | pbitools_install_pending]

### Input Format Detection

**Format Detected**: [pbip | pbi-tools | pbix | pbix-extracted-pbitools | unknown]

**Project Path**: `<absolute-path-to-original-input>`

**Original PBIX**: `<path-to-original-pbix>` (if extracted from PBIX, otherwise "N/A")

### Action Required Details
[Only populated when Status = action_required]

**Required Action**: [Description of what user needs to do]

**User Choices Available**: [Y/N/I] or [manual instructions]

**Next Steps**: [What will happen after user responds]

### Extraction Details
[Populated after successful extraction from PBIX]

**Extraction Method**: [none | automatic-pbitools | manual-pending]

**Extraction Status**: [n/a | success | pending]

**Extracted Folder Path**: `<path-to-extracted-folder>`

**pbi-tools Version**: [version number] (if used, otherwise "N/A")

### Project Structure
[Populated after validation succeeds]

**Semantic Model Path**:
- For .pbip: `<project>/<Name>.SemanticModel/definition/`
- For pbi-tools: `<project>/Model/`
- For pbix-extracted-pbitools: `<extracted-folder>/Model/`

**Report Path**:
- For .pbip: `<project>/<Name>.Report/` (if exists, otherwise "N/A")
- For pbi-tools: N/A (pbi-tools format)

**TMDL Structure**: [validated | invalid]
- `model.tmdl`: [Found | Missing]
- `database.tmdl`: [Found | N/A | Missing] (required for pbi-tools format only)
- `tables/` folder: [Found | Missing]
- `relationships.tmdl`: [Found | Not Found]

### Review & Deployment Requirements
[Populated after validation succeeds]

**Can Open in Power BI Desktop**: [Yes - Open .pbip file directly | Requires Compilation]

**Compilation Required for Review**: [false | true]

**Compilation Command** (if required):
```bash
cd "<project-path>"
pbi-tools compile . "output.pbit" PBIT -overwrite
```

**Deployment Format**:
- If .pbip: Can publish directly from Power BI Desktop
- If pbi-tools/pbix-extracted-pbitools: Compile to PBIT, then publish after opening and refreshing

### Metadata
[Critical fields for downstream agents - ALWAYS populated when Status = validated]

**format**: [pbip | pbi-tools | pbix-extracted-pbitools]

**requires_compilation**: [true | false]

**validated_project_path**: `<path-to-use-for-analysis>`
  - This is the path that should be used by all subsequent agents (code-locator, code-fix-identifier, etc.)
  - For .pbip: Same as original project path
  - For pbi-tools: Same as original project path
  - For pbix-extracted-pbitools: Path to extracted folder

### Error Details
[Only populated when Status = error]

**Error Message**: [Clear description of the problem]

**Files Expected**: [What files/folders were expected]

**Files Found**: [What was actually found at the path]

**Suggested Fix**: [How to resolve the issue]

### Notes

[Any additional notes, warnings, or observations about the project setup]

---

## Section 1: Current Implementation Investigation

This section documents the existing implementation relevant to the problem statement.

### A. Calculation Code Investigation
[Generated by powerbi-code-locator agent]

This subsection documents existing DAX measures, M queries, calculated columns, and TMDL model definitions.

#### [Object Name] - [Object Type]
**Location:** [filename.tmdl](path/to/file.tmdl)

**Current Code:**
```dax
[existing DAX code here]
```

**Description:** [Factual description of what this code does]

---

### B. Visual Current State Investigation
[Generated by powerbi-visual-locator agent - only for visual/hybrid requests]

This subsection documents the current state of PBIR visuals that will be modified.

**Status**: [Documented | Not Applicable]

**Not Applicable Reason** (if Status = Not Applicable):
- No visual changes requested
- Project format does not include .Report folder (pbi-tools format)

#### Visual: [Visual Display Name]
**Page**: [Page display name]
**File Path**: [Relative path to visual.json](path/to/pages/.../visual.json)
**Visual Type**: [barChart | lineChart | table | card | slicer | etc.]

**Layout Properties**:
- **Position**: (x: [number], y: [number])
- **Size**: [width]px × [height]px

**Current Configuration** (relevant properties):
```json
{
  "visualType": "barChart",
  "title": { "text": "Sales by Region" },
  "width": 400,
  "height": 250
}
```

**Data Bindings** (fields/measures used by visual):
- **Values**: [[Measure Name 1]], [[Measure Name 2]]
- **Axis/Categories**: [[Column Name]]
- **Filters**: [[Filter specifications]]

**Formatting** (current styling - relevant excerpts):
- **Title**: "Sales by Region" (font: Segoe UI, 14pt, #000000)
- **Colors**: [Color scheme or data colors]
- **Axes**: [Axis label configurations]

---

[Repeat for each visual that will be modified]

---

## Section 2: Proposed Changes
[Generated by powerbi-dashboard-update-planner or powerbi-artifact-designer agents]

This section documents the recommended code changes, new implementations, and visual modifications.

**For Hybrid Changes**: When both calculation and visual changes are proposed, this section includes coordination notes explaining dependencies and execution order.

---

**Coordination Summary** (for hybrid changes only):

[Only populated when BOTH Section 2.A and 2.B have changes]

**Change Type**: HYBRID (Calculation + Visual)

**Dependencies**:
- [Description of how calculation changes affect visual changes]
- [Example: "Visual references new measure 'YoY Growth %' created in Section 2.A"]

**Execution Order**:
1. Apply calculation changes (Section 2.A) FIRST
2. Apply visual changes (Section 2.B) SECOND

**Cross-References**:
- Section 2.A items referenced by visuals: [[list]]
- Section 2.B visuals affected by new calculations: [[list]]

---

### A. Calculation Changes
[Generated by powerbi-dashboard-update-planner or powerbi-artifact-designer agent]

This subsection documents changes to the data model: DAX measures, M queries, calculated columns, tables, and relationships.

#### [Object Name] - [Object Type]
**Change Type:** [MODIFY | CREATE | DELETE]
**Target Location:** [filename.tmdl](path/to/file.tmdl)

**Original Code:** (if modifying existing code - Change Type: MODIFY)
```dax
[existing code here]
```

**Proposed Code:**
```dax
[new/modified code here]
```

**Styling & Metadata:** (optional - include when styling changes or new artifacts)
- **Format String:** `"pattern"` (e.g., `"$#,0.00"` for currency, `"0.0%"` for percentage)
- **Display Folder:** `"folder/path"` (e.g., `"Sales Metrics"`, `"Growth Metrics"`)
- **Description:** `"tooltip text"` (concise explanation shown in tooltips)
- **Data Category:** [None | Email | WebURL | ImageURL | etc.]

**Change Rationale:** [Explanation of what changed and why, including performance considerations, best practices applied, styling decisions, and pattern adherence]

**Research Sources:** (optional - include if web research was performed)
- [Article/Forum Post Title] - [URL]
- [Expert Blog Post] - [URL]
- [Microsoft Docs Reference] - [URL]
- [Key insights from research that informed this solution]

**Dependencies:** (optional - document required artifacts)
- [Required measures, columns, tables, or relationships]

**Validation Notes:** (optional - document edge case handling)
- [How edge cases are handled]
- [Performance considerations]

---

### B. Visual Changes
[Generated by pbir-visual-edit-planner agent]

This subsection documents changes to report visuals: layout, formatting, visual types, and data bindings in PBIR files.

**Change Type**: PBIR_VISUAL_EDIT

**Applicability**: Only for Power BI Project (.pbip) format with .Report folder. Not applicable for pbi-tools or pbix-extracted-pbitools formats.

**Status**: [Changes Proposed | Not Applicable | Manual Action Required]

#### Affected Visuals
[Only populated when visual changes are proposed]

- **Visual Name**: [Display name of the visual, e.g., "Sales by Region"]
- **Page**: [Page display name, e.g., "Commission Details"]
- **File Path**: [Relative path to visual.json](path/to/visual.json)

#### Change Summary

[Human-readable description of what visual properties will change]

Example:
- Resize visual to 500px width × 300px height
- Reposition to coordinates (100, 200)
- Update title from "Sales by Region" to "Regional Performance"
- Change visual type from bar chart to line chart
- Update axis label font size to 14pt

#### XML Edit Plan

[Machine-executable edit plan in XML format - consumed by implementation workflow]

```xml
<edit_plan>
  <step
    file_path="definition/pages/ReportSection123/visuals/VisualContainer456/visual.json"
    operation="replace_property"
    json_path="width"
    new_value="500"
  />
  <step
    file_path="definition/pages/ReportSection123/visuals/VisualContainer456/visual.json"
    operation="config_edit"
    json_path="title.text"
    new_value="'Regional Performance'"
  />
</edit_plan>
```

**Operation Types**:
- `replace_property`: Direct modification of top-level visual.json properties (e.g., width, height, x, y, visualType)
- `config_edit`: Modification of properties inside the stringified config blob (requires parse-edit-stringify)

#### Implementation Notes

[Technical notes about applying the visual changes]

Example:
- The `config_edit` operation requires parsing the config string blob, modifying the specified JSON path, then re-stringifying
- The `replace_property` operation directly modifies top-level visual.json properties
- Backup the .Report folder before applying changes

#### Not Applicable Reason

[Only populated when Status = Not Applicable]

**Reason**: [One of:]
- No visual changes requested in problem statement
- Project format does not support automated visual editing (pbi-tools or pbix-extracted-pbitools)
- Visual changes require manual application in Power BI Desktop

---

### C. Manual Actions Required
[Optional - populated when automated changes cannot cover all requirements]

This subsection documents actions that must be performed manually in Power BI Desktop after automated changes are applied.

**Scenario**: [When this applies - e.g., pbi-tools format with visual changes, UI-only features like field parameters]

**Manual Steps**:

1. [Manual step 1 - e.g., "Open the project in Power BI Desktop"]
2. [Manual step 2 - e.g., "Create field parameter 'Labor Metric Selector' with measures: Commission, GP, Sales"]
3. [Manual step 3 - e.g., "Add slicer to Commission Details page"]

**Why Manual Action Required**:
[Explanation - e.g., "Field parameters must be created through the Modeling ribbon UI and cannot be generated via TMDL editing alone"]

---

## Section 3: Test Cases and Impact Analysis
[Optional section for documenting test scenarios and impact assessment]

### Test Cases

#### Test Case 1: [Test Name]
**Objective:** [What this test verifies]

**Test Steps:**
1. [Step 1]
2. [Step 2]
3. [Step 3]

**Expected Result:** [What should happen]

**Actual Result:** [What actually happened - to be filled during testing]

---

### Impact Analysis

#### Performance Impact
[Assessment of how changes affect query performance, refresh times, model size, etc.]

#### Downstream Dependencies
[Tables, measures, reports, or visualizations affected by these changes]

#### Breaking Changes
[Any changes that might break existing functionality or require updates elsewhere]

#### Data Integrity Considerations
[How changes affect data accuracy, completeness, or consistency]

---

## Section 4: Implementation Notes
[Optional section for additional context, gotchas, or follow-up items]

### Prerequisites
- [Any required setup or configuration before implementing changes]

### Implementation Order
1. [First change to make]
2. [Second change to make]
3. [etc.]

### Post-Implementation Validation
- [ ] [Validation step 1]
- [ ] [Validation step 2]
- [ ] [etc.]

### Known Limitations
[Any limitations or edge cases to be aware of]

### Future Enhancements
[Potential improvements to consider after initial implementation]
